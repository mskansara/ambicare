<nav class="black">
    <a href="#" class="brand-logo center">Ambicare</a>
    <a href="#" data-target="slide-out" class="sidenav-trigger"><i class="material-icons">menu</i></a>
</nav>
<ul id="slide-out" class="sidenav">
    <li><div class="user-view">
      <div class="background">
        <img src="../../static/images/user-profile-bg.jpg">
      </div>
      <a href="#user"><img class="circle" src="../../static/images/yuna.jpg"></a>
      <a href="#name"><span class="white-text name">John Doe</span></a>
      <a href="#email"><span class="white-text email">jdandturk@gmail.com</span></a>
    </div></li>
    <li><a href="#!">Booking History</a></li>
    <li><a href="#!">Cancel Booking</a></li>
    <li><div class="divider">Update Profile</div></li>
    <li><a class="waves-effect" href="#!">Logout</a></li>
</ul>
  
<div class="container" id="map" style="width:100%; height:80vh;">
    
</div>
<hr>
<center><div class="waves-effect waves-light btn black btn-med" v-on:click="sendUserDetails">Book Now</div></center>

    
    {{!-- Importing Vue JS --}}
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    {{!-- Importing Socket.io --}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4Xyj--YZ3XsqPC3BTrDim9gX99VEruVg"></script> 

<script>
    $(document).ready(function(){
        $('.sidenav').sidenav();
    });
</script>

<script>
    Vue.config.delimiters = ['${', '}']
    var app = new Vue({
        el: '#app',
        data: {
            userLatLng: {},
            driverLatLng: {},
            map,
            socket: io(),
            user_socket: io(),
            markers: [],
            userDetails: {}
        },
        mounted: function() {
            if(navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(this.showPosition);
            } else {
                console.log("Geo Location not supported by browser");
            }
            //Socket for listening driver's location
            this.socket.on('location', function(data){
                this.driverLatLng = data;
                var driver = {
                    coords: {lat: this.driverLatLng.latitude, lng: this.driverLatLng.longitude},
                    content: 'Driver location'
                }
            });
        },
        methods: {
            initMap: function() {},
            addMarker: function(props) {
                var marker = new google.maps.Marker({
                    position: props.coords,
                    map: this.map,
                    title: 'Locations',
                });

                //Check content
                if(props.content) {
                    var infoWindow = new google.maps.InfoWindow({
                        content:props.content
                    });
                    marker.addListener('click', function(){
                        infoWindow.open(this.map, marker);
                    });
                }
                return;
            },
            showPosition: function(position) {
                this.userLatLng.latitude = position.coords.latitude;
                this.userLatLng.longitude = position.coords.longitude;
                this.map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 14,
                    center: {lat: this.userLatLng.latitude, lng: this.userLatLng.longitude}
                })
                this.markers = [
                    {
                        coords: {lat: 19.461171, lng: 72.813013},
                        content: 'Your current location'
                    },
                    {
                        coords: {lat: 19.4566757, lng: 72.8191789},
                        content: 'Driver Location',
                    }
                ];
                for(var i = 0; i < this.markers.length; i++){
                    // Add marker
                    this.addMarker(this.markers[i]);
                    console.log(this.markers[i].coords);
                }
                /*var infowindow = new google.maps.InfoWindow({
                    content: 'Your current location',
                    maxWidth: 200
                });
                this.markers[0].addListener('click', function() {
                    infowindow.open(this.map, this.markers);
                });*/
                return;
            },
            sendUserDetails: function() {
                this.userDetails = {
                    name: "Manthan Kansara",
                    email: "manthankansara7@gmail.com",
                    phone: "8454044679",
                    location: "Virar (East)"
                }
                this.socket.json.emit('user_details', this.userDetails);
            }
        }
    })
</script>